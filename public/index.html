<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hexadecision - I-Ching con IA</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      color: #e4e4e7;
      background: linear-gradient(135deg, rgba(15,15,35,0.92) 0%, rgba(26,26,46,0.92) 50%, rgba(22,33,62,0.92) 100%),
                  url('https://images.unsplash.com/photo-1513002749550-c59d786b8e6c?w=1920&q=80') center/cover fixed;
    }
    .container { max-width: 800px; margin: 0 auto; padding: 2rem 1rem; }
    header { text-align: center; margin-bottom: 3rem; }
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 30px rgba(245,158,11,0.3);
    }
    .tagline { color: #a1a1aa; font-size: 1.1rem; }
    .input-section {
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    label { display: block; margin-bottom: 0.75rem; color: #d4d4d8; font-size: 1rem; }
    textarea {
      width: 100%;
      padding: 1rem;
      border: 2px solid rgba(245,158,11,0.3);
      border-radius: 12px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 1rem;
      resize: none;
      transition: border-color 0.3s;
    }
    textarea:focus { outline: none; border-color: #f59e0b; }
    button {
      width: 100%;
      padding: 1rem 2rem;
      margin-top: 1rem;
      border: none;
      border-radius: 12px;
      background: linear-gradient(90deg, #f59e0b, #d97706);
      color: #000;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(245,158,11,0.4); }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .result-section { display: none; }
    .result-section.visible { display: block; animation: fadeIn 0.5s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .hexagrams-display { display: flex; justify-content: center; align-items: center; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap; }
    .hexagram-card { 
      background: rgba(0,0,0,0.4); 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 16px; 
      padding: 1.5rem; 
      text-align: center; 
      min-width: 180px; 
    }
    .hexagram-visual { font-size: 1.5rem; margin-bottom: 0.5rem; font-family: monospace; line-height: 1.4; color: #f59e0b; white-space: pre; }
    .hexagram-chinese { font-size: 3rem; margin-bottom: 0.5rem; }
    .hexagram-name { font-size: 1.1rem; color: #fbbf24; margin-bottom: 0.25rem; }
    .hexagram-number { color: #71717a; font-size: 0.9rem; }
    .arrow { font-size: 2rem; color: #f59e0b; }
    .intensity-bar { 
      background: rgba(0,0,0,0.4); 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 8px; 
      padding: 1rem; 
      margin-bottom: 2rem; 
      text-align: center; 
    }
    .intensity-label { margin-bottom: 0.5rem; color: #a1a1aa; }
    .intensity-track { height: 12px; background: rgba(0,0,0,0.5); border-radius: 6px; overflow: hidden; }
    .intensity-fill { height: 100%; background: linear-gradient(90deg, #22c55e, #f59e0b, #ef4444); border-radius: 6px; transition: width 0.5s ease; }
    .lineas-moviles { text-align: center; color: #a1a1aa; margin-bottom: 1.5rem; }
    .interpretacion { 
      background: rgba(0,0,0,0.4); 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 16px; 
      padding: 1.5rem; 
      margin-bottom: 2rem; 
      line-height: 1.7; 
    }
    .interpretacion h3 { color: #fbbf24; margin-bottom: 1rem; }
    .nueva-consulta { margin-top: 1rem; }
    footer { text-align: center; padding: 2rem; color: rgba(255,255,255,0.4); font-size: 0.9rem; }
    footer a { color: #f59e0b; text-decoration: none; }
    .loading { display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
    .spinner { width: 20px; height: 20px; border: 3px solid rgba(0,0,0,0.2); border-top-color: #000; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>HEXADECISION</h1>
      <p class="tagline">I-Ching con interpretación de IA</p>
    </header>
    <div class="input-section">
      <label for="pregunta">¿Cuál es tu pregunta?</label>
      <textarea id="pregunta" rows="3" placeholder="Escribe tu pregunta con claridad y sinceridad..."></textarea>
      <button id="btn-consultar">CONSULTAR EL ORÁCULO</button>
    </div>
    <div id="resultado" class="result-section">
      <div class="hexagrams-display">
        <div class="hexagram-card">
          <div class="hexagram-visual" id="visual1"></div>
          <div class="hexagram-chinese" id="chino1"></div>
          <div class="hexagram-name" id="nombre1"></div>
          <div class="hexagram-number" id="numero1"></div>
        </div>
        <div class="arrow">→</div>
        <div class="hexagram-card">
          <div class="hexagram-visual" id="visual2"></div>
          <div class="hexagram-chinese" id="chino2"></div>
          <div class="hexagram-name" id="nombre2"></div>
          <div class="hexagram-number" id="numero2"></div>
        </div>
      </div>
      <div class="intensity-bar">
        <div class="intensity-label">Intensidad del cambio: <span id="intensidad-valor">0%</span></div>
        <div class="intensity-track"><div class="intensity-fill" id="intensidad-fill" style="width: 0%"></div></div>
      </div>
      <div class="lineas-moviles">Líneas que cambian: <span id="lineas"></span></div>
      <div class="interpretacion">
        <h3>Interpretación</h3>
        <p id="interpretacion-texto"></p>
      </div>
      <button class="nueva-consulta" id="btn-nueva">Nueva consulta</button>
    </div>
  </div>
  <footer>Hecho por <a href="https://duendes.app" target="_blank">duendes.app</a> 2026</footer>
  <script>
    var hexagramasData = [];
    fetch("/hexagramas.json").then(function(r){return r.json()}).then(function(data){hexagramasData=data.hexagramas}).catch(function(e){console.error(e)});
    function binarioAVisual(b){return b.split("").map(function(x){return x==="1"?"━━━━━":"━━ ━━"}).join("\n")}
    document.getElementById("btn-consultar").addEventListener("click", async function(){
      var pregunta = document.getElementById("pregunta").value.trim();
      if(!pregunta || pregunta.length < 3){alert("Por favor, escribe una pregunta válida.");return}
      var btn = this;
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"><span class="spinner"></span> Consultando...</span>';
      try {
        var response = await fetch("/api/consulta", {method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pregunta:pregunta})});
        var data = await response.json();
        if(data.error){alert(data.error);return}
        var h1 = hexagramasData[data.hexagramaPrimario - 1] || {};
        var h2 = hexagramasData[data.hexagramaSecundario - 1] || {};
        document.getElementById("visual1").textContent = binarioAVisual(data.binarioPrimario);
        document.getElementById("chino1").textContent = h1.chino || "";
        document.getElementById("nombre1").textContent = h1.nombre || "Hexagrama " + data.hexagramaPrimario;
        document.getElementById("numero1").textContent = "#" + data.hexagramaPrimario;
        document.getElementById("visual2").textContent = binarioAVisual(data.binarioSecundario);
        document.getElementById("chino2").textContent = h2.chino || "";
        document.getElementById("nombre2").textContent = h2.nombre || "Hexagrama " + data.hexagramaSecundario;
        document.getElementById("numero2").textContent = "#" + data.hexagramaSecundario;
        document.getElementById("intensidad-valor").textContent = data.intensidadCambio + "%";
        document.getElementById("intensidad-fill").style.width = data.intensidadCambio + "%";
        document.getElementById("lineas").textContent = data.lineasMoviles.length > 0 ? data.lineasMoviles.join(", ") : "Ninguna";
        document.getElementById("interpretacion-texto").textContent = data.interpretacion;
        document.getElementById("resultado").classList.add("visible");
        document.getElementById("resultado").scrollIntoView({behavior:"smooth"});
      } catch(error) {
        console.error(error);
        alert("Error al consultar. Intenta de nuevo.");
      } finally {
        btn.disabled = false;
        btn.textContent = "CONSULTAR EL ORÁCULO";
      }
    });
    document.getElementById("btn-nueva").addEventListener("click", function(){
      document.getElementById("resultado").classList.remove("visible");
      document.getElementById("pregunta").value = "";
      window.scrollTo({top:0,behavior:"smooth"});
    });
  </script>
</body>
</html>
